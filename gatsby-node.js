const mockData = [
  {
    id: "14f14e33-ded3-4ab9-b9d5-3eacfda65b08",
    name: "Nisko",
    mainImagePath: "Nisko/1698261754103-nisko-2.jpeg",
    city: "Niedrzwica Duża",
    voivodeship: "lubelskie",
    numberOfPegs: 7,
    priceMin: 15.0,
    fishOnLake: [],
    regulations: null,
    facilities: [],
    latitude: 49.959015,
    longitude: 22.838013,
    pegs: [
      {
        pegNumber: 1,
        pegName: "Stanowisko 1",
        pegId: "3f11014b-f52d-43f4-84a1-7eef721d6cc5",
      },
      {
        pegNumber: 2,
        pegName: "Stanowisko 2",
        pegId: "9412a235-d770-4a9d-83cc-8dd16d425e5f",
      },
      {
        pegNumber: 3,
        pegName: "Stanowisko 3",
        pegId: "3fe7bf92-dc29-49f0-9fb6-8da61de80ec7",
      },
      {
        pegNumber: 4,
        pegName: "Stanowisko 4",
        pegId: "cfd04d40-0b00-4ffd-9e4e-5c09bf2bcf7d",
      },
      {
        pegNumber: 5,
        pegName: "Stanowisko 5",
        pegId: "810c1f9b-11dd-4626-af27-302a37002f09",
      },
      {
        pegNumber: 6,
        pegName: "Stanowisko 6",
        pegId: "aa5d3003-1c69-439b-bbfd-a6e3641ac4b8",
      },
      {
        pegNumber: 7,
        pegName: "Stanowisko 7",
        pegId: "8ab41a72-5a90-407c-a3d2-d384f6bad85d",
      },
    ],
    images: [
      {
        path: "Nisko/images/1698261876885-nisko-8.jpeg",
      },
      {
        path: "Nisko/images/1698261802173-nisko-3.jpeg",
      },
      {
        path: "Nisko/images/1698261868244-nisko-7.jpeg",
      },
      {
        path: "Nisko/images/1698261788569-nisko-1.jpeg",
      },
      {
        path: "Nisko/images/1698261838917-nisko-4.jpeg",
      },
      {
        path: "Nisko/images/1698261857186-nisko-6.jpeg",
      },
      {
        path: "Nisko/images/1698261849317-nisko-5.jpeg",
      },
    ],
    metadata: {
      id: "06503548-7b17-4a94-b0a9-02132c909061",
      keywords: "ABC",
      description: "TEST",
    },
    extraServices: [
      {
        id: "0ba27951-bdfe-4b7c-a966-148f667ff82d",
        name: "Przyczepa",
        price: "45",
      },
      {
        id: "26099044-21a0-4b94-abc4-897067e3bdb9",
        name: "Ponton",
        price: "25",
      },
    ],
    paymentOnPlace: false,
    paymentOnline: false,
    downPaymentAsPercents: null,
    pegBasePrice: 45.0,
    rules: {
      rentalPerDay: true,
      rentalPerHour: false,
      availableDays: ["lista stringow"],
      rentalStartTime: "10:00",
      rentalEndTime: "20:00",
      allDays: false,
      startRangeDays: ["stringi"],
      endRangeDays: ["stringi"],
      startDay: "double",
      endDay: "double",
    },
  },
  {
    id: "32301682-6bf7-4875-b605-00c13629da48",
    name: "Witkowice",
    mainImagePath: "Witkowice/1701118450376-gal2.jpg",
    city: "Chwałowice",
    voivodeship: "podkarpackie",
    numberOfPegs: 21,
    priceMin: 5.0,
    fishOnLake: [],
    regulations: null,
    facilities: [],
    latitude: 50.752419,
    longitude: 21.878162,
    pegs: [
      {
        pegNumber: 1,
        pegName: "Stanowisko 1",
        pegId: "6c4080b3-74fc-40ab-b146-0228ab430833",
      },
      {
        pegNumber: 2,
        pegName: "Stanowisko 2",
        pegId: "b0faa9e6-2480-469d-9938-be323a91a057",
      },
      {
        pegNumber: 3,
        pegName: "Stanowisko 3",
        pegId: "e31d790d-fb4e-4ad9-bb7c-f7261f67e480",
      },
      {
        pegNumber: 4,
        pegName: "Stanowisko 4",
        pegId: "438468b2-8043-4f1a-b37f-f34fd03eb3ce",
      },
      {
        pegNumber: 5,
        pegName: "Stanowisko 5",
        pegId: "65ec82d2-7ba4-4d21-bc8a-ceb1a02dae32",
      },
      {
        pegNumber: 6,
        pegName: "Stanowisko 6",
        pegId: "e45613c5-a9d9-4227-a189-d8ec6d53a80e",
      },
      {
        pegNumber: 7,
        pegName: "Stanowisko 7",
        pegId: "3ea1ffbf-527a-4345-99a0-f716ebf98824",
      },
      {
        pegNumber: 8,
        pegName: "Stanowisko 8",
        pegId: "00503997-8d6a-40e6-90b6-ed123dedaa14",
      },
      {
        pegNumber: 9,
        pegName: "Stanowisko 9",
        pegId: "c59a8395-2d16-4f7a-81e7-0ca8c87d7420",
      },
      {
        pegNumber: 10,
        pegName: "Stanowisko 10",
        pegId: "f4a49f2e-8a64-4a8c-a1f4-cc6dfab7fa96",
      },
      {
        pegNumber: 11,
        pegName: "Stanowisko 11",
        pegId: "d33fa359-bef5-4dca-b265-559df099ceab",
      },
      {
        pegNumber: 12,
        pegName: "Stanowisko 12",
        pegId: "052d1fc6-b4ef-47b6-9bb6-136a28eb8aa7",
      },
      {
        pegNumber: 13,
        pegName: "Stanowisko 13",
        pegId: "410ff65b-f53b-4d50-98f4-1dc6505cdac7",
      },
      {
        pegNumber: 14,
        pegName: "Stanowisko 14",
        pegId: "9d727e91-9adf-4f00-91ea-1934ad8b4e6b",
      },
      {
        pegNumber: 15,
        pegName: "Stanowisko 15",
        pegId: "efc5849b-a17e-40dd-bf87-b2df0dd96b52",
      },
      {
        pegNumber: 16,
        pegName: "Stanowisko 16",
        pegId: "3cda7d44-818a-48f4-9087-0972e3fb4af2",
      },
      {
        pegNumber: 17,
        pegName: "Stanowisko 17",
        pegId: "19f14bc0-eb98-47ec-bf7f-c6f45305f837",
      },
      {
        pegNumber: 18,
        pegName: "Stanowisko 18",
        pegId: "5080d20f-1d35-4c10-809e-4ecb78951a33",
      },
      {
        pegNumber: 19,
        pegName: "Stanowisko 19",
        pegId: "a9976f90-a8c9-4087-90c1-18d1a7f4dd14",
      },
      {
        pegNumber: 20,
        pegName: "Stanowisko 20",
        pegId: "044080ab-0949-4ab2-b3ec-13e9b7babe8d",
      },
      {
        pegNumber: 21,
        pegName: "Stanowisko 21",
        pegId: "95bf00b0-a81f-4d44-b7fd-cb1d95350f02",
      },
    ],
    images: [
      {
        path: "Witkowice/images/1701116124757-Witkowice.png",
      },
    ],
    metadata: {
      id: "2977d7c0-5257-49ca-bdbd-0f8392d4deaa",
      keywords: null,
      description: null,
    },
    extraServices: [],
    paymentOnPlace: false,
    paymentOnline: false,
    downPaymentAsPercents: null,
    pegBasePrice: 15.0,
  },
  {
    id: "72453e69-c9b9-4266-a03d-4a42d74e42f4",
    name: "Cicha Woda",
    mainImagePath: "Cicha+Woda/1698321403346-Cicha-main.jpeg",
    city: "Niedrzwica Duża",
    voivodeship: "lubelskie",
    numberOfPegs: 7,
    priceMin: 15.0,
    fishOnLake: [],
    regulations: null,
    facilities: [],
    latitude: 51.09926,
    longitude: 22.363504,
    pegs: [
      {
        pegNumber: 1,
        pegName: "Stanowisko 1",
        pegId: "f1337c4d-e3ef-4ac0-a31d-aeec3904b386",
      },
      {
        pegNumber: 2,
        pegName: "Stanowisko 2",
        pegId: "b9081a57-58a8-481b-b800-6f710f2a326d",
      },
      {
        pegNumber: 3,
        pegName: "Stanowisko 3",
        pegId: "83039670-629b-4ec3-91e6-a5db859e8584",
      },
      {
        pegNumber: 4,
        pegName: "Stanowisko 4",
        pegId: "f6960881-3a9c-4d8f-99ca-9d1ae5c5ff36",
      },
      {
        pegNumber: 5,
        pegName: "Stanowisko 5",
        pegId: "7250c2f3-7753-4fa3-b605-0a72c0c54a15",
      },
      {
        pegNumber: 6,
        pegName: "Stanowisko 6",
        pegId: "75c4f413-9ec3-479b-a5c9-0d53d629017b",
      },
      {
        pegNumber: 7,
        pegName: "Stanowisko 7",
        pegId: "24583075-f9dd-4d6b-b7fb-bae06a168772",
      },
    ],
    images: [
      {
        path: "Cicha+Woda/images/1698321437933-Cicha-3.jpeg",
      },
      {
        path: "Cicha+Woda/images/1698321462054-Cicha-6.jpeg",
      },
      {
        path: "Cicha+Woda/images/1698321445132-Cicha-4.jpeg",
      },
      {
        path: "Cicha+Woda/images/1698321428416-Cicha-2.jpeg",
      },
      {
        path: "Cicha+Woda/images/1698321467807-Cicha-main.jpeg",
      },
      {
        path: "Cicha+Woda/images/1698321454039-Cicha-5.jpeg",
      },
    ],
    metadata: {
      id: "a0b779c3-0a1c-4501-ab31-e0ac87a99e55",
      keywords: "ABC",
      description: "TEST",
    },
    extraServices: [],
    paymentOnPlace: false,
    paymentOnline: false,
    downPaymentAsPercents: null,
    pegBasePrice: 45.0,
  },
  {
    id: "ae09923c-d6ab-4b5a-bb09-1dc287ed9c44",
    name: "Łowisko Testowe",
    mainImagePath: "Łowisko+Testowe/1703883515428-staw.jpg",
    city: "Stalowa Wola",
    voivodeship: "Podkarpackie",
    numberOfPegs: 3,
    priceMin: 50.0,
    fishOnLake: [],
    regulations: null,
    facilities: [],
    latitude: 50.558619,
    longitude: 22.083028,
    pegs: [
      {
        pegNumber: 1,
        pegName: "Stanowisko 1",
        pegId: "a71e5d73-ed11-4b7b-97c0-4f247f7f40fc",
      },
      {
        pegNumber: 2,
        pegName: "Stanowisko 2",
        pegId: "6b445f63-21b6-48c9-b8f8-b74fd326b3de",
      },
      {
        pegNumber: 3,
        pegName: "Stanowisko 3",
        pegId: "a9a64845-de84-4baa-a4d6-bc0111bdc8a3",
      },
    ],
    images: [
      {
        path: "Łowisko+Testowe/images/1703881096356-1.jpg",
      },
      {
        path: "Łowisko+Testowe/images/1703881093005-2.jpg",
      },
      {
        path: "Łowisko+Testowe/images/1703881083660-3.jpg",
      },
      {
        path: "Łowisko+Testowe/images/1703881045266-4.jpg",
      },
    ],
    metadata: {
      id: "419e917b-2e46-4b2a-b414-7ac46eac4c66",
      keywords: "Stalowa Wola",
      description: "Staw Lomaxa",
    },
    extraServices: [],
    paymentOnPlace: false,
    paymentOnline: false,
    downPaymentAsPercents: null,
    pegBasePrice: 50.0,
  },
];

function sortData(data) {
  const result = {
    voivodeships: [],
    cities: [],
  };

  const voivodeships = new Set();
  const cities = new Set();

  data.forEach((item) => {
    voivodeships.add(item.voivodeship);
    cities.add(item.city);
  });

  voivodeships.forEach((voivodeship) => {
    result.voivodeships.push({
      name: voivodeship,
      items: data.filter((item) => item.voivodeship === voivodeship),
    });
  });

  cities.forEach((city) => {
    result.cities.push({
      name: city,
      items: data.filter((item) => item.city === city),
      voivodeship: data.find((item) => item.city === city).voivodeship,
    });
  });
  return result;
}

const fetch = (...args) =>
  import(`node-fetch`).then(({ default: fetch }) => fetch(...args));

const getStaticDataFromApi = async () => {
  // try {
  //   const response = await fetch(
  //     `https://hookandrod.herokuapp.com/api/lakes/static`,
  //     {
  //       mode: "cors",
  //       headers: {
  //         "Access-Control-Allow-Origin": "*",
  //         Accept: "application/json",
  //         "Content-Type": "application/json",
  //       },
  //       withCredentials: false,
  //       credentials: "same-origin",
  //       crossdomain: true,
  //     }
  //   );
  //   const data = await response.json();
  //   if (data.error) {
  //     return new Error(data.error);
  //   }
  //   return data;
  // } catch (error) {
  //   console.error("error while fetching from API", error);
  // }
  return mockData;
};

exports.createPages = async ({ actions: { createPage }, createNodeId }) => {
  try {
    const data = await getStaticDataFromApi();
    const sortedData = sortData(data); //data sorted by voivodeship and city
    const allLakes = data; // unsorted raw data of all lakes
    sortedData.voivodeships.forEach((voiv) => {
      createPage({
        path: `${voiv.name}`,
        component: require.resolve("./src/templates/voivodeship"),
        context: { voivodeship: voiv.name },
      });
    });
    sortedData.cities.forEach((city) => {
      createPage({
        path: `${city.voivodeship}/${city.name}`,
        component: require.resolve("./src/templates/city"),
        context: { city: city.name },
      });
    });
    allLakes.forEach(async (item) => {
      console.log("lake item", item);
      const lake = {
        ...item,
        //mainImagePath: `https://hookrod.s3.eu-central-1.amazonaws.com/${item.mainImagePath}`,
      };
      createPage({
        path: `${lake.voivodeship}/${lake.city}/${lake.name}`,
        component: require.resolve("./src/templates/lake"),
        context: {
          id: String(lake.id),
        },
      });
    });
  } catch (error) {
    console.error("Server responded with error", error);
  }
};
// https://hookrod.s3.eu-central-1.amazonaws.com/Extra+Carp+Radymno/1675710309282-117714995_3471086599610855_7441530922398424970_o.jpg
exports.createSchemaCustomization = ({ actions }) => {
  const { createTypes } = actions;
  //todo : Add properties for SEO such as description and keywords
  createTypes(`
    type Lake implements Node {
      id: ID!
      pegs: [Peg!]!
      name: String!
      mainImagePath: String
      images: [ImageUrl]
      city: String!
      voivodeship: String!
      numberOfPegs: Int!
      priceMin: Float!
      regulations: String
      latitude: Float!
      longitude: Float!
      fishOnLake: [FishOnLake]!
      facilities: [Facility]!
      pegBasePrice:  Float!
      metadata: MetaData
      extraServices: [ExtraService]
      paymentOnPlace: Boolean
      paymentOnline: Boolean
      downPaymentAsPercents: Int
    }

    type ExtraService {
      id: ID
      name: String
      price: Float
    }

    type MetaData {
      id: ID
      description: String
      keywords: String
    }

    type Peg {
      pegId: ID
      pegName: String
      pegNumber: Int
    }

    type ImageUrl {
      path: String
    }

    type FishOnLake {
      name: String
      weight: Float
      length: Float
    }

    type Facility {
      name: String
      basePrice: Int
    }

  `);
};

exports.sourceNodes = async ({
  actions,
  createNodeId,
  createContentDigest,
}) => {
  const lakes = await getStaticDataFromApi();
  lakes.forEach((item) => {
    const node = {
      id: `${item.id}`,
      name: item.name,
      city: item.city,
      voivodeship: item.voivodeship,
      numberOfPegs: item.numberOfPegs,
      priceMin: item.priceMin,
      latitude: item.latitude,
      longitude: item.longitude,
      pegs: item.pegs,
      images: item.images,
      pegBasePrice: item.pegBasePrice,
      metadata: item.metadata,
      extraServices: item.extraServices,
      paymentOnPlace: item.paymentOnPlace,
      paymentOnline: item.paymentOnline,
      downPaymentAsPercents: item.downPaymentAsPercents,
      parent: null,
      children: [],
      internal: {
        type: "Lake",
        contentDigest: createContentDigest(item),
      },
    };
    if (item.images.length > 0) {
      node.images = item.images;
    }
    if (item.mainImagePath) {
      node.mainImagePath = `https://hookrod.s3.eu-central-1.amazonaws.com/${item.mainImagePath}`;
    } else {
      node.mainImagePath =
        "https://res.cloudinary.com/dbzx3snkc/image/upload/v1687464590/misc/Screenshot_2023-06-22_at_22.07.15_oo2ypz.png";
    }
    if (
      item.fishOnLake &&
      Array.isArray(item.fishOnLake) &&
      item.fishOnLake.length > 0
    ) {
      node.fishOnLake = item.fishOnLake;
    } else {
      node.fishOnLake = [];
    }
    if (
      item.facilities &&
      Array.isArray(item.facilities) &&
      item.facilities.length > 0
    ) {
      node.facilities = item.facilities;
    } else {
      node.facilities = [];
    }
    actions.createNode(node);
  });
};

// exports.onCreateWebpackConfig = ({ actions }) => {
//   actions.setWebpackConfig({
//     module: {
//       rules: [
//         {
//           test: /\.svg$/,
//           use: ["@svgr/webpack"],
//         },
//       ],
//     },
//   });
// };
